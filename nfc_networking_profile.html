<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart Contact Card</title>
<style>
  :root{
    --bg:#eef3ff; --card:#ffffff; --muted:#8a90a2; --ink:#111827;
    --primary:#4f46e5; --accent:#10b981; --ring:#dbe2ff;
    --shadow: 0 10px 30px rgba(24,39,75,.08), 0 2px 8px rgba(24,39,75,.06);
    --radius:22px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:
      radial-gradient(1000px 600px at -10% -10%, #dfe8ff 0%, transparent 70%),
      radial-gradient(900px 500px at 120% 10%, #e7f6ff 0%, transparent 65%),
      var(--bg);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    color:var(--ink); line-height:1.25;
  }
  .wrap{max-width:840px; margin:40px auto; padding:0 20px}
  .card{
    background:var(--card); border-radius:22px; box-shadow:var(--shadow);
    padding:28px; position:relative; overflow:hidden;
  }
  .header{display:flex; align-items:center; gap:20px; padding-bottom:18px; border-bottom:1px solid #f1f5ff}
  .avatar{width:96px; height:96px; border-radius:24px; background:#f3f4f6; overflow:hidden; display:grid; place-items:center; box-shadow: inset 0 0 0 1px #eef2ff}
  .avatar img{width:100%; height:100%; object-fit:cover; display:block}
  .title h1{margin:0 0 6px 0; font-size:28px; font-weight:800}
  .title p{margin:0; color:var(--muted)}
  .grid{display:grid; gap:16px; margin-top:22px; grid-template-columns: repeat(2, minmax(0,1fr))}
  @media (max-width:720px){ .grid{grid-template-columns:1fr} }
  label{font-size:12px; color:#6b7280; margin-bottom:6px; display:block}
  input, textarea{
    width:100%; border:1px solid #e6e9f9; border-radius:14px; padding:12px 14px;
    font-size:15px; outline:0; background:#fbfcff;
  }
  input:focus, textarea:focus{box-shadow:0 0 0 4px var(--ring); border-color:#c7d2fe}
  textarea{min-height:88px; resize:vertical}
  .row{display:flex; gap:14px}
  .btn{
    display:inline-flex; align-items:center; justify-content:center; gap:10px;
    background:var(--primary); color:#fff; border:none; padding:12px 16px;
    border-radius:14px; font-weight:700; cursor:pointer; box-shadow:var(--shadow);
  }
  .btn.sec{background:#eef2ff; color:#3b3f5c}
  .note{color:var(--muted); font-size:13px}
  .out{margin-top:18px; background:#f7f8ff; border:1px dashed #c7d2fe; padding:14px; border-radius:14px; overflow:auto}
  .pillbar{display:flex; gap:12px; margin-top:14px; flex-wrap:wrap}
  .pill{background:#f5f7ff; border-radius:16px; padding:10px 12px; font-size:13px; color:#4b5563; display:flex; align-items:center; gap:8px; box-shadow: inset 0 0 0 1px #e5e9ff}
  .actions{display:flex; gap:10px; flex-wrap:wrap}
  .iconbtn{width:48px; height:48px; display:grid; place-items:center; border-radius:14px; background:#eef2ff; box-shadow:var(--shadow); color:#374151; text-decoration:none; font-weight:900}
  .field{display:flex; align-items:center; justify-content:space-between; gap:12px}
  .field span{font-weight:700}
  .divider{height:1px; background:#f1f5ff; margin:10px 0}
  .footerNote{margin-top:8px; font-size:12px; color:#6b7280}
  .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  .lenok{font-size:12px; color:#6b7280}
  .hide{display:none !important}
  .err{margin-top:12px; padding:10px 12px; border-radius:12px; background:#fee2e2; color:#7f1d1d; border:1px solid #fecaca}
</style>
</head>
<body>
<div class="wrap">
  <div id="createCard" class="card">
    <div class="header">
      <div class="avatar"><img id="preview" alt="Profile picture preview" src="" onerror="this.src=''; this.parentElement.style.background='#f3f4f6'"></div>
      <div class="title">
        <h1>Create your contact</h1>
        <p>Fill the form ‚Üí generate a compact link (‚â§492 chars) for your NFC tag.</p>
      </div>
    </div>

    <div class="grid" id="formGrid">
      <div><label>Profile picture URL</label><input id="pic" placeholder="https://‚Ä¶" oninput="updatePreview(this.value)"></div>
      <div><label>Full name</label><input id="name" placeholder="Ada Lovelace"></div>
      <div><label>University</label><input id="uni" placeholder="USC"></div>
      <div><label>Major</label><input id="major" placeholder="Astronautical Engineering"></div>
      <div><label>Grade level</label><input id="grade" placeholder="Graduate / Junior / etc."></div>
      <div><label>Interests (comma-separated)</label><input id="interests" placeholder="Propulsion, Avionics, Robotics"></div>
      <div><label>LinkedIn URL</label><input id="li" placeholder="https://www.linkedin.com/in/username"></div>
      <div class="row">
        <div style="flex:1"><label>Phone</label><input id="phone" placeholder="(555) 123-4567"></div>
        <div style="flex:1"><label>Email</label><input id="email" placeholder="you@example.com"></div>
      </div>
    </div>

    <div class="row" style="margin-top:16px">
      <button class="btn" type="button" id="genBtn">Generate link</button>
      <button class="btn sec" type="button" onclick="clearForm()">Reset</button>
    </div>

    <div id="errBox" class="err hide"></div>

    <div class="out hide" id="outBox">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px">
        <div class="note">Copy this URL into your NFC tag writer (URL/URI record). It opens a read-only card.</div>
        <div class="lenok"><span id="lenNum">0</span> chars</div>
      </div>
      <div class="mono" id="urlText" style="margin-top:8px; word-break:break-all"></div>
    </div>
    <div class="footerNote">All data stays in the URL hash (no server). The ‚Äúview‚Äù page has no edit controls.</div>
  </div>

  <div id="viewCard" class="card hide" aria-live="polite">
    <div class="header">
      <div class="avatar"><img id="v_pic" alt=""></div>
      <div class="title">
        <h1 id="v_name">Your Name</h1>
        <p id="v_sub" class="mono"></p>
      </div>
    </div>
    <div class="pillbar">
      <div class="pill"><span id="v_uni">University</span></div>
      <div class="pill"><span id="v_major">Major</span></div>
      <div class="pill"><span id="v_grade">Grade</span></div>
    </div>
    <div style="margin-top:18px">
      <div class="field"><span>Phone</span><a id="v_phone" class="iconbtn" title="Call">üìû</a></div>
      <div class="divider"></div>
      <div class="field"><span>Email</span><a id="v_email" class="iconbtn" title="Email">‚úâÔ∏è</a></div>
      <div class="divider"></div>
      <div class="field"><span>LinkedIn</span><a id="v_li" class="iconbtn" title="LinkedIn">in</a></div>
    </div>
    <div style="margin-top:18px">
      <label>Interests</label>
      <div id="v_interests" class="pillbar"></div>
    </div>
    <div class="footerNote">This card is read-only. To create your own, open the base file without the <code>#!</code> part.</div>
  </div>
</div>

<script>
/* ------- Minimal LZ-String (URI safe) ------- */
var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},e={compressToEncodedURIComponent:function(o){return null==o?"":e._compress(o,6,function(o){return r.charAt(o)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:e._decompress(t.length,32,function(e){return o(r,t.charAt(e))})},_compress:function(o,r,t){if(null==o)return"";var e,n,i,s={},p={},u="",a="",c="",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,p[u]=!0),a=c+u,Object.prototype.hasOwnProperty.call(s,a))c=a;else{if(Object.prototype.hasOwnProperty.call(p,c)){if(c.charCodeAt(0)<256){for(e=0;e<h;e++)m<<=1,v==r-1?(v=0,d.push(t(m)),m=0):v++;for(n=c.charCodeAt(0),e=0;e<8;e++)m=m<<1|1&n,v==r-1?(v=0,d.push(t(m)),m=0):v++,n>>=1}else{for(n=1,e=0;e<h;e++)m=m<<1|n,v==r-1?(v=0,d.push(t(m)),m=0):v++,n=0;for(n=c.charCodeAt(0),e=0;e<16;e++)m=m<<1|1&n,v==r-1?(v=0,d.push(t(m)),m=0):v++,n>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[c]}else for(n=s[c],e=0;e<h;e++)m=m<<1|1&n,v==r-1?(v=0,d.push(t(m)),m=0):v++,n>>=1;l--,0==l&&(l=Math.pow(2,h),h++),s[a]=f++,c=String(u)}if(""!==c){if(Object.prototype.hasOwnProperty.call(p,c)){if(c.charCodeAt(0)<256){for(e=0;e<h;e++)m<<=1,v==r-1?(v=0,d.push(t(m)),m=0):v++;for(n=c.charCodeAt(0),e=0;e<8;e++)m=m<<1|1&n,v==r-1?(v=0,d.push(t(m)),m=0):v++,n>>=1}else{for(n=1,e=0;e<h;e++)m=m<<1|n,v==r-1?(v=0,d.push(t(m)),m=0):v++,n=0;for(n=c.charCodeAt(0),e=0;e<16;e++)m=m<<1|1&n,v==r-1?(v=0,d.push(t(m)),m=0):v++,n>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[c]}else for(n=s[c],e=0;e<h;e++)m=m<<1|1&n,v==r-1?(v=0,d.push(t(m)),m=0):v++,n>>=1;l--,0==l&&(l=Math.pow(2,h),h++)}for(n=2,e=0;e<h;e++)m=m<<1|n,v==r-1?(v=0,d.push(t(m)),m=0):v++,n=0;for(;;){if(m<<=1,v==r-1){d.push(t(m));break}v++}return d.join("")},_decompress:function(o,r,t){var e,n,i,s,p,u,a,c,l,f=[],h=4,d=4,m=3,v="",w=[],A={val:t(0),position:r,index:1};for(e=0;e<3;e+=1)f[e]=e;for(i=0,p=Math.pow(2,2),u=1;u!=p;)s=A.val&A.position,A.position>>=1,0==A.position&&(A.position=r,A.val=t(A.index++)),i|=(s>0?1:0)*u,u<<=1;switch(i){case 0:for(i=0,p=Math.pow(2,8),u=1;u!=p;)s=A.val&A.position,A.position>>=1,0==A.position&&(A.position=r,A.val=t(A.index++)),i|=(s>0?1:0)*u,u<<=1;c=n=String.fromCharCode(i);break;case 1:for(i=0,p=Math.pow(2,16),u=1;u!=p;)s=A.val&A.position,A.position>>=1,0==A.position&&(A.position=r,A.val=t(A.index++)),i|=(s>0?1:0)*u,u<<=1;c=n=String.fromCharCode(i);break;case 2:return""}for(f[3]=n,a=n,l=w;!0;){if(A.index>o)return"";for(i=0,p=Math.pow(2,m),u=1;u!=p;)s=A.val&A.position,A.position>>=1,0==A.position&&(A.position=r,A.val=t(A.index++)),i|=(s>0?1:0)*u,u<<=1;switch(c=i){case 0:for(i=0,p=Math.pow(2,8),u=1;u!=p;)s=A.val&A.position,A.position>>=1,0==A.position&&(A.position=r,A.val=t(A.index++)),i|=(s>0?1:0)*u,u<<=1;f[d++]=String.fromCharCode(i),c=d-1,h--;break;case 1:for(i=0,p=Math.pow(2,16),u=1;u!=p;)s=A.val&A.position,A.position>>=1,0==A.position&&(A.position=r,A.val=t(A.index++)),i|=(s>0?1:0)*u,u<<=1;f[d++]=String.fromCharCode(i),c=d-1,h--;break;case 2:return l.join("")}if(0==h&&(h=Math.pow(2,m),m++),f[c])v=f[c];else{if(c!==d)return null;v=a+a.charAt(0)}l.push(v),f[d++]=a+v.charAt(0),a=v,0==--h&&(h=Math.pow(2,m),m++)}}
  return e;}();

/* ---------- UI helpers ---------- */
function showErr(msg){
  const box=document.getElementById('errBox');
  box.textContent=msg; box.classList.remove('hide');
}
function clearErr(){ document.getElementById('errBox').classList.add('hide'); }
function updatePreview(url){ document.getElementById('preview').src=(url||'').trim(); }

/* Normalize for compactness without losing info */
function compactify(data){
  let li=(data.li||'').trim().replace(/^https?:\/\//i,'').replace(/^www\./i,'');
  let phone=(data.phone||'').replace(/[^\d+]/g,'');
  for(const k of Object.keys(data)) if(typeof data[k]==='string') data[k]=data[k].trim();
  return [data.pic, data.name, data.uni, data.major, data.grade, data.interests, li, phone, data.email];
}
function restore(arr){
  const [pic,name,uni,major,grade,interests,li,phone,email]=arr;
  return { pic, name, uni, major, grade, interests,
           li: li ? (li.startsWith('http')? li : 'https://'+li) : '',
           phone, email };
}

/* ---------- Generate link ---------- */
function generate(){
  clearErr();
  try{
    const data={
      pic:pic.value, name:name.value, uni:uni.value, major:major.value, grade:grade.value,
      interests:interests.value, li:li.value, phone:phone.value, email:email.value
    };
    const packed=compactify(data);
    const json=JSON.stringify(packed);
    const hash=LZString.compressToEncodedURIComponent(json);

    // Safari/file:// safe base (no origin dependency)
    const base=window.location.href.replace(/#.*/,'');
    const url=base + "#!" + hash;

    urlText.textContent=url;
    lenNum.textContent=url.length;
    outBox.classList.remove('hide');
    lenNum.style.color = (url.length>492) ? '#b91c1c' : '#6b7280';
  }catch(err){
    showErr("Could not generate link: " + (err && err.message ? err.message : String(err)));
  }
}

/* ---------- Clear ---------- */
function clearForm(){
  ['pic','name','uni','major','grade','interests','li','phone','email'].forEach(id=>document.getElementById(id).value='');
  updatePreview(''); outBox.classList.add('hide'); clearErr();
}

/* ---------- Render view-only card ---------- */
function renderView(obj){
  createCard.classList.add('hide'); viewCard.classList.remove('hide');
  v_pic.src=obj.pic||''; v_name.textContent=obj.name||'';
  v_sub.textContent=(obj.phone?obj.phone:'') + (obj.phone&&obj.email?' ¬∑ ':'') + (obj.email?obj.email:'');
  v_uni.textContent=obj.uni||''; v_major.textContent=obj.major||''; v_grade.textContent=obj.grade||'';
  v_interests.innerHTML='';
  (obj.interests||'').split(',').map(s=>s.trim()).filter(Boolean).forEach(s=>{
    const el=document.createElement('div'); el.className='pill'; el.textContent=s; v_interests.appendChild(el);
  });
  const phoneDigits=(obj.phone||'').replace(/[^\d+]/g,'');
  v_phone.href=phoneDigits?('tel:'+phoneDigits):'#';
  v_email.href=obj.email?('mailto:'+obj.email):'#';
  v_li.href=obj.li||'#';
  [['v_phone',!!phoneDigits],['v_email',!!obj.email],['v_li',!!obj.li]].forEach(([id,has])=>{
    if(!has) document.getElementById(id).classList.add('hide');
  });
}

/* ---------- Boot ---------- */
(function(){
  // click handler (avoid inline-onclick race conditions)
  document.getElementById('genBtn').addEventListener('click', generate);

  if(location.hash.startsWith('#!')){
    try{
      const payload=location.hash.slice(2);
      const json=LZString.decompressFromEncodedURIComponent(payload);
      const arr=JSON.parse(json);
      renderView(restore(arr));
    }catch(e){
      showErr("Invalid or corrupted contact link.");
    }
  }else{
    createCard.classList.remove('hide');
  }
})();
</script>
</body>
</html>