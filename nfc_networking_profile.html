<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Smart NFC Contact</title>
<style>
  /* --- Clean UI Refresh ------------------------------------------- */
:root{
  --bg:#0b0f16;             /* darker canvas */
  --card:#0f1420;           /* card surface */
  --stroke:#222a3a;         /* subtle borders */
  --muted:#9aa3b2;
  --text:#eef2ff;
  --accent:#7aa2ff;
}

body{
  background: radial-gradient(60% 55% at 70% 0%, #131a2a 0%, #0b0f16 55%) fixed;
}

/* Phone shell */
.phone{
  background: linear-gradient(180deg,#0a0f18,#090d14);
  border: 1px solid #121827;
  border-radius: 28px;
  padding: 14px;
  box-shadow: 0 22px 60px rgba(0,0,0,.55);
}

/* Screen/hero */
.screen{ border-radius: 22px; overflow: hidden; }
.hero{
  height: 180px;
  background: linear-gradient(180deg,#1b2335 0%, #0e1422 90%);
}
.badge{
  top: 16px; right: 16px;
  color:#ced6ea; border-color:#233047;
  background: rgba(255,255,255,.05);
}

/* Cards */
.card{
  margin: -20px 14px 14px;
  padding: 16px;
  border-radius: 18px;
  background: rgba(15,20,32,0.82);
  border: 1px solid var(--stroke);
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
  backdrop-filter: blur(8px);
}

/* Title/role */
.name h2{
  font-size: 20px; line-height: 1.2; letter-spacing:.2px;
}
.role{
  margin-top: 4px;
  color: #a9b4c8; font-size: 13.5px;
}

/* Primary actions */
.actions{
  display:flex; gap: 10px; margin: 12px 0 10px;
}
.iconbtn{
  width: 44px; height: 44px;
  border-radius: 12px;
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg,#151c2b,#0f1623);
  color:#d7def0;
  box-shadow: inset 0 -1px 0 rgba(255,255,255,.03);
}
.iconbtn:hover{ transform: translateY(-1px); }

/* Save button */
.save{
  height: 46px; border-radius: 14px;
  font-size: 15px; font-weight: 600;
  color: #ecf1ff;
  background: linear-gradient(180deg,#1f2b45,#121a2f);
  border: 1px solid var(--stroke);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.04);
}

/* Chip grid (replaces bulky squares) */
.grid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}
.app{
  height:auto; padding:10px 12px;
  border-radius: 999px;
  border: 1px solid var(--stroke);
  background: rgba(18,24,39,.65);
  display:flex; align-items:center; gap:8px;
}
.app .dot{
  width:20px; height:20px; border-radius:7px;
  background:#1a2336; border:1px solid #24314a;
}
.app .label{
  color:#c8d2e3; font-size:12.5px; line-height:1;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}

/* Panel (editor) polish */
.panel{
  background: rgba(18,24,39,.75);
  border-color: var(--stroke);
  backdrop-filter: blur(8px);
  border-radius:16px;
}
.field input, .field textarea{
  background:#0d1320;border:1px solid #1f2738;border-radius:12px;
}
.primary{
  background: linear-gradient(180deg,#2b58ff,#2346cc);
  box-shadow: 0 6px 18px rgba(42,88,255,.22);
}
.ghost{ background:#0e1424; border-color:#1f2738; }
</style>
</head>
<body>
<div class="container">
  <div id="viewMode" class="shell hide">
    <div class="phone"><div class="screen">
      <div class="hero"><div class="badge">Profile</div></div>
      <div class="card">
        <div class="name">
          <h2 id="v_name">—</h2>
          <div class="verify">✓</div>
        </div>
        <div class="role" id="v_role">—</div>
        <div class="actions">
          <a id="v_call" class="iconbtn" aria-label="Call" title="Call">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M6.6 10.8c1.2 2.4 3.2 4.4 5.6 5.6l1.9-1.9c.3-.3.8-.4 1.2-.3 1.3.4 2.7.6 4.1.6.7 0 1.2.5 1.2 1.2v3.5c0 .7-.5 1.2-1.2 1.2C9.8 20.9 3.1 14.2 3.1 5.6 3.1 4.9 3.6 4.3 4.3 4.3H7.8c.7 0 1.2.5 1.2 1.2 0 1.4.2 2.8.6 4.1.1.4 0 .9-.3 1.2L6.6 10.8z"/>
            </svg>
          </a>
          <a id="v_mail" class="iconbtn" aria-label="Email" title="Email">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Zm0 4-8 5L4 8V6l8 5 8-5v2Z"/>
            </svg>
          </a>
          <a id="v_linkedin" class="iconbtn" aria-label="LinkedIn" title="LinkedIn" target="_blank" rel="noopener">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M4.98 3.5a2.5 2.5 0 1 0 .02 5 2.5 2.5 0 0 0-.02-5ZM3 8.98h4v12H3v-12Zm7.5 0h3.8v1.64h.05c.53-.99 1.82-2.04 3.75-2.04 4.01 0 4.75 2.64 4.75 6.07v6.33h-4v-5.61c0-1.34-.03-3.07-1.87-3.07-1.87 0-2.16 1.46-2.16 2.97v5.71h-4v-12Z"/>
            </svg>
          </a>
        </div>
        <button id="btnVCF" class="save">Save Contact</button>
      </div>
      <div class="card">
        <div class="grid">
          <div class="app"><div class="dot"></div><div class="label" id="v_university">University</div></div>
          <div class="app"><div class="dot"></div><div class="label" id="v_major">Major</div></div>
          <div class="app"><div class="dot"></div><div class="label" id="v_grade">Grade</div></div>
          <div class="app"><div class="dot"></div><div class="label" id="v_interests" title=""></div></div>
        </div>
      </div>
    </div></div>
    <div class="panel">
      <h3>Read-only Card</h3>
      <div class="hint">This view is read-only. To create your own, open <code>index.html</code> (no hash) and generate a link.</div>
    </div>
  </div>

  <div id="editMode" class="shell">
    <div class="panel">
      <h3>Create Your Profile</h3>
      <div class="field"><label>Full Name</label><input id="i_name" placeholder="Ada Lovelace" required></div>
      <div class="field"><label>University</label><input id="i_uni" placeholder="USC"></div>
      <div class="field"><label>Major</label><input id="i_major" placeholder="Astronautical Engineering"></div>
      <div class="field"><label>Grade Level</label><input id="i_grade" placeholder="Graduate / Junior / etc."></div>
      <div class="field"><label>Interests</label><textarea id="i_interests" placeholder="Propulsion, systems, AI…"></textarea></div>
      <div class="field"><label>LinkedIn URL</label><input id="i_li" placeholder="https://www.linkedin.com/in/username"></div>
      <div class="field"><label>Phone</label><input id="i_phone" placeholder="+1 555-555-5555"></div>
      <div class="field"><label>Email</label><input id="i_mail" placeholder="you@example.com"></div>

      <div class="row">
        <button id="btnGen" class="primary">Generate Read-Only Link</button>
        <button id="btnFillDemo" class="ghost" type="button">Fill Demo</button>
      </div>
      <div id="out" class="hide">
        <div class="urlbox">
          <input id="outUrl" readonly>
          <button id="btnCopy" class="ghost" type="button">Copy</button>
          <button id="btnOpen" class="primary" type="button">Open</button>
        </div>
        <div class="hint">
          URL length: <span id="len" class="lenok">0</span> / 492 characters.
          Links use compressed <code>#v=…</code> so they’re NFC-friendly.
        </div>
      </div>
    </div>

    <div class="phone"><div class="screen">
      <div class="hero"><div class="badge">Preview</div></div>
      <div class="card">
        <div class="name"><h2 id="p_name">Your Name</h2><div class="verify">✓</div></div>
        <div class="role" id="p_role">Major · University</div>
        <div class="actions">
          <div class="iconbtn" title="Call (preview)"><svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M6.6 10.8c1.2 2.4 3.2 4.4 5.6 5.6l1.9-1.9c.3-.3.8-.4 1.2-.3 1.3.4 2.7.6 4.1.6.7 0 1.2.5 1.2 1.2v3.5c0 .7-.5 1.2-1.2 1.2C9.8 20.9 3.1 14.2 3.1 5.6 3.1 4.9 3.6 4.3 4.3 4.3H7.8c.7 0 1.2.5 1.2 1.2 0 1.4.2 2.8.6 4.1.1.4 0 .9-.3 1.2L6.6 10.8z"/></svg></div>
          <div class="iconbtn" title="Email (preview)"><svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Zm0 4-8 5L4 8V6l8 5 8-5v2Z"/></svg></div>
          <div class="iconbtn" title="LinkedIn (preview)"><svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M4.98 3.5a2.5 2.5 0 1 0 .02 5 2.5 2.5 0 0 0-.02-5ZM3 8.98h4v12H3v-12Zm7.5 0h3.8v1.64h.05c.53-.99 1.82-2.04 3.75-2.04 4.01 0 4.75 2.64 4.75 6.07v6.33h-4v-5.61c0-1.34-.03-3.07-1.87-3.07-1.87 0-2.16 1.46-2.16 2.97v5.71h-4v-12Z"/></svg></div>
        </div>
        <button class="save" disabled>Save Contact</button>
      </div>
      <div class="card">
        <div class="grid">
          <div class="app"><div class="dot"></div><div class="label" id="p_uni">University</div></div>
          <div class="app"><div class="dot"></div><div class="label" id="p_major">Major</div></div>
          <div class="app"><div class="dot"></div><div class="label" id="p_grade">Grade</div></div>
          <div class="app"><div class="dot"></div><div class="label" id="p_interests">Interests</div></div>
        </div>
      </div>
    </div></div>
  </div>
</div>

<footer>Tip: Write the generated link to your NFC tag with “URL/URI” type. Opening that URL shows only the card.</footer>

<script>
/* ==== ultra-tiny LZ-based URL encoder (subset of LZ-String) ==== */
const LZ = (function(){
  function u(t){return encodeURIComponent(t).replace(/%20/g," ")}
  function d(t){try{return decodeURIComponent(t)}catch(e){return t}}
  function c(input){
    if(input==null) return "";
    let context_dictionary={}, context_dictionaryToCreate={}, context_c="", context_wc="", context_w="", context_enlargeIn=2,
        context_dictSize=3, context_numBits=2, data=[], data_val=0, data_position=0, ii;
    function writeBit(value){
      data_val=(data_val<<1)|value; if(++data_position==6){ data.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(data_val)); data_position=0; data_val=0; }
    }
    function writeBits(numBits,value){
      for(let i=0;i<numBits;i++){ writeBit(value&1); value>>=1; }
    }
    for(ii=0; ii<input.length; ii++){
      context_c=input.charAt(ii);
      if(!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)){
        context_dictionary[context_c]=context_dictSize++;
        context_dictionaryToCreate[context_c]=true;
      }
      context_wc=context_w+context_c;
      if(Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)){
        context_w=context_wc;
      }else{
        if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){
          if(context_w.charCodeAt(0)<256){
            writeBits(context_numBits,0); writeBits(8,context_w.charCodeAt(0));
          }else{
            writeBits(context_numBits,1); writeBits(16,context_w.charCodeAt(0));
          }
          context_enlargeIn--; if(context_enlargeIn==0){ context_enlargeIn=Math.pow(2,context_numBits); context_numBits++; }
          delete context_dictionaryToCreate[context_w];
        }else{
          writeBits(context_numBits,context_dictionary[context_w]);
        }
        context_enlargeIn--; if(context_enlargeIn==0){ context_enlargeIn=Math.pow(2,context_numBits); context_numBits++; }
        context_dictionary[context_wc]=context_dictSize++; context_w=String(context_c);
      }
    }
    if(context_w!==""){
      if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){
        if(context_w.charCodeAt(0)<256){ writeBits(context_numBits,0); writeBits(8,context_w.charCodeAt(0)); }
        else { writeBits(context_numBits,1); writeBits(16,context_w.charCodeAt(0)); }
        delete context_dictionaryToCreate[context_w];
      }else{
        writeBits(context_numBits,context_dictionary[context_w]);
      }
      context_enlargeIn--; if(context_enlargeIn==0){ context_enlargeIn=Math.pow(2,context_numBits); context_numBits++; }
    }
    writeBits(context_numBits,2);
    while(true){ data_val=(data_val<<1); if(++data_position==6){ data.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(data_val)); break; } }
    return data.join("");
  }
  function dc(input){
    if(!input) return "";
    const keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";
    let dictionary=[0,1,2], enlargeIn=4, dictSize=4, numBits=3, entry="", result=[], w,
        bits, resb, maxpower, power, c, data={val:keyStr.indexOf(input.charAt(0)),position:32,index:1};
    function readBits(n){
      let power=1, res=0, max=1<<n;
      for(let i=0;i<n;i++){ resb=data.val & data.position; data.position >>=1;
        if(data.position==0){ data.position=32; data.val=keyStr.indexOf(input.charAt(data.index++)); }
        if(resb>0) res |= power; power <<=1; }
      return res;
    }
    bits=readBits(2);
    switch(bits){
      case 0: c=String.fromCharCode(readBits(8)); break;
      case 1: c=String.fromCharCode(readBits(16)); break;
      case 2: return "";
    }
    dictionary[3]=c; w=c; result.push(c);
    while(true){
      if(data.index>input.length) return "";
      bits=readBits(numBits);
      let cc;
      if(bits===0){ cc=String.fromCharCode(readBits(8)); dictionary[dictSize++]=cc; bits=dictSize-1; enlargeIn--; }
      else if(bits===1){ cc=String.fromCharCode(readBits(16)); dictionary[dictSize++]=cc; bits=dictSize-1; enlargeIn--; }
      else if(bits===2){ return result.join(""); }
      if(enlargeIn==0){ enlargeIn=1<<numBits; numBits++; }
      entry = dictionary[bits] ? dictionary[bits] : (bits===dictSize ? w + w[0] : null);
      if(entry==null) return "";
      result.push(entry); dictionary[dictSize++]=w+entry[0]; w=entry;
      if(--enlargeIn==0){ enlargeIn=1<<numBits; numBits++; }
    }
  }
  return {
    encURI:(obj)=>c(u(obj)),
    decURI:(s)=>d(dc(s))
  };
})();
/* ============================================================= */

const $=s=>document.querySelector(s);
const paramOrder=["name","uni","major","grade","interests","li","phone","mail"];

function pack(fields){
  // Tab-joined (very compact) then LZ+URI encoded
  return LZ.encURI(fields.map(v=>v.replace(/\t/g," ")).join("\t"));
}
function unpack(str){
  const raw=LZ.decURI(str)||"";
  const parts=raw.split("\t");
  const out={}; for(let i=0;i<paramOrder.length;i++){ out[paramOrder[i]]=parts[i]||""; }
  return out;
}
function buildURL(payload){
  const base = location.origin + location.pathname.replace(/index\.html?$/i,"");
  return base + "#v=" + payload;
}
function setPreview(){
  const n=$('#i_name').value.trim()||"Your Name";
  const uni=$('#i_uni').value.trim()||"University";
  const major=$('#i_major').value.trim()||"Major";
  const grade=$('#i_grade').value.trim()||"Grade";
  const interests=$('#i_interests').value.trim()||"Interests";

  $('#p_name').textContent=n;
  $('#p_role').textContent=`${major} · ${uni}`;
  $('#p_uni').textContent=uni||"—";
  $('#p_major').textContent=major||"—";
  $('#p_grade').textContent=grade||"—";
  $('#p_interests').textContent=(interests||"—").slice(0,28)+(interests.length>28?'…':'');
}

function gen(){
  const vals = [
    $('#i_name').value.trim(),
    $('#i_uni').value.trim(),
    $('#i_major').value.trim(),
    $('#i_grade').value.trim(),
    $('#i_interests').value.trim(),
    $('#i_li').value.trim(),
    $('#i_phone').value.trim(),
    $('#i_mail').value.trim()
  ];
  const comp = pack(vals);
  const url = buildURL(comp);
  const ok = url.length<=492;
  $('#outUrl').value=url;
  $('#out').classList.remove('hide');
  const len = url.length;
  const lenEl = $('#len');
  lenEl.textContent = len;
  lenEl.className = len<=492 ? 'lenok' : 'lenbad';
  if(!ok) alert("Warning: URL exceeds 492 characters. Shorten fields (especially LinkedIn) or use a shorter domain.");
}

function copyLink(){ $('#outUrl').select(); document.execCommand('copy'); }
function openLink(){ const u=$('#outUrl').value; if(u) location.href=u; }

function vcardFrom(o){
  const n=o.name||"";
  const email=o.mail||"";
  const tel=o.phone||"";
  const org=o.uni||"";
  const title=o.major||"";
  const note=(o.grade?`Grade: ${o.grade}\\n`:"")+(o.interests?`Interests: ${o.interests}`:"");
  return `BEGIN:VCARD
VERSION:3.0
FN:${n}
ORG:${org}
TITLE:${title}
TEL;TYPE=CELL:${tel}
EMAIL;TYPE=INTERNET:${email}
URL:${o.li||""}
NOTE:${note}
END:VCARD`.replace(/\n/g,"\r\n");
}

/* ---------- wire up editor ---------- */
['#i_name','#i_uni','#i_major','#i_grade','#i_interests'].forEach(sel=>{
  document.addEventListener('input', e=>{ if(e.target.matches(sel)) setPreview(); });
});
$('#btnGen').addEventListener('click', gen);
$('#btnCopy').addEventListener('click', copyLink);
$('#btnOpen').addEventListener('click', openLink);
$('#btnFillDemo').addEventListener('click', ()=>{
  $('#i_name').value="Ahmed Gamal";
  $('#i_uni').value="USC";
  $('#i_major').value="Product Designer";
  $('#i_grade').value="Graduate";
  $('#i_interests').value="Design systems, mobile UX, motion";
  $('#i_li').value="https://linkedin.com/in/ahmed";
  $('#i_phone').value="+1 555 555 1234";
  $('#i_mail').value="ahmed@example.com";
  setPreview();
});
setPreview();

/* ---------- view-only mode ---------- */
(function init(){
  const m = location.hash.match(/^#v=([\w\-]+)$/);
  if(!m){ // editor mode
    $('#editMode').classList.remove('hide'); $('#viewMode').classList.add('hide'); return;
  }
  const data = unpack(m[1]);
  $('#editMode').classList.add('hide'); $('#viewMode').classList.remove('hide');

  const role = [data.major,data.uni].filter(Boolean).join(" · ");
  $('#v_name').textContent = data.name || "—";
  $('#v_role').textContent = role || "—";
  $('#v_university').textContent = data.uni || "—";
  $('#v_major').textContent = data.major || "—";
  $('#v_grade').textContent = data.grade || "—";
  $('#v_interests').textContent = (data.interests||"—").slice(0,32);
  $('#v_interests').title = data.interests || "";

  // Buttons
  if(data.phone){ $('#v_call').href = "tel:"+data.phone.replace(/\s+/g,""); }
  else { $('#v_call').classList.add('hide'); }

  if(data.mail){ $('#v_mail').href = "mailto:"+data.mail; }
  else { $('#v_mail').classList.add('hide'); }

  if(data.li){ $('#v_linkedin').href = data.li; }
  else { $('#v_linkedin').classList.add('hide'); }

  // vCard download
  document.getElementById('btnVCF').addEventListener('click', ()=>{
    const vcf=vcardFrom({name:data.name, mail:data.mail, phone:data.phone, uni:data.uni, major:data.major, grade:data.grade, interests:data.interests, li:data.li});
    const blob=new Blob([vcf],{type:"text/vcard"});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download=(data.name||"contact").replace(/[^\w\-]+/g,'_')+".vcf";
    a.click();
    setTimeout(()=>URL.revokeObjectURL(a.href),1500);
  }, {once:true});
})();
</script>
</body>
</html>
